
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="MongooseIM is a mobile messaging platform with focus on performance and scalability">
      
      
        <meta name="author" content="Erlang Solutions">
      
      
        <link rel="canonical" href="https://esl.github.io/MongooseDocs/latest/latest/modules/mod_mam/">
      
      
        <link rel="prev" href="../mod_last/">
      
      
        <link rel="next" href="../mod_muc/">
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.3">
    
    
      
        <title>mod_mam - MongooseIM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c4a75a56.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-description" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MongooseIM" class="md-header__button md-logo" aria-label="MongooseIM" data-md-component="logo">
      
  <img src="../../MongooseIM_logo_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MongooseIM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              mod_mam
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/esl/MongooseIM" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MongooseIM" class="md-nav__button md-logo" aria-label="MongooseIM" data-md-component="logo">
      
  <img src="../../MongooseIM_logo_white.png" alt="logo">

    </a>
    MongooseIM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/esl/MongooseIM" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/Installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/Quick-setup/" class="md-nav__link">
        Quick Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/Features/" class="md-nav__link">
        Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/Supported-standards/" class="md-nav__link">
        Supported Standards
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/High-level-Architecture/" class="md-nav__link">
        High-level Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How-to-build/" class="md-nav__link">
        How to Build MongooseIM from source code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/push-notifications/Push-notifications/" class="md-nav__link">
        How to Set up Push Notifications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/push-notifications/Push-notifications-client-side/" class="md-nav__link">
        How to Set up Push Notifications on the client side
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/push-notifications/MongoosePush-setup/" class="md-nav__link">
        How to Set up MongoosePush
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/ICE_tutorial/" class="md-nav__link">
        How to Set up MongooseICE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/iOS_tutorial/" class="md-nav__link">
        How to Build an iOS messaging app
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/Jingle-SIP-setup/" class="md-nav__link">
        How to Set up Jingle/SIP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/client-certificate/" class="md-nav__link">
        How to Set up SASL client certificate authentication
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Open XMPP Extensions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Open XMPP Extensions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-extensions/muc_light/" class="md-nav__link">
        MUC light
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-extensions/inbox/" class="md-nav__link">
        Inbox
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-extensions/smart-markers/" class="md-nav__link">
        Smart Markers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-extensions/token-reconnection/" class="md-nav__link">
        Token-based reconnection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-extensions/mam/" class="md-nav__link">
        MAM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/configuration-files/" class="md-nav__link">
        Configuration Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/general/" class="md-nav__link">
        Options: General
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/listen/" class="md-nav__link">
        Options: Listen
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/auth/" class="md-nav__link">
        Options: Auth
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/outgoing-connections/" class="md-nav__link">
        Options: Outgoing connections
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/Services/" class="md-nav__link">
        Options: Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/Modules/" class="md-nav__link">
        Options: Extension Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/shaper/" class="md-nav__link">
        Options: Shaper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/acl/" class="md-nav__link">
        Options: Acl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/access/" class="md-nav__link">
        Options: Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/s2s/" class="md-nav__link">
        Options: S2S
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/host_config/" class="md-nav__link">
        Options: Host config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/release-options/" class="md-nav__link">
        Release Options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/Erlang-cookie-security/" class="md-nav__link">
        Erlang Cookie Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/TLS-hardening/" class="md-nav__link">
        TLS Hardening
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/database-backends-configuration/" class="md-nav__link">
        Database Backends Configuration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Authentication Methods
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Authentication Methods
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/rdbms/" class="md-nav__link">
        RDBMS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/external/" class="md-nav__link">
        External
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/anonymous/" class="md-nav__link">
        Anonymous
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/ldap/" class="md-nav__link">
        LDAP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/jwt/" class="md-nav__link">
        JWT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/riak/" class="md-nav__link">
        Riak (deprecated)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/http/" class="md-nav__link">
        HTTP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/pki/" class="md-nav__link">
        PKI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/dummy/" class="md-nav__link">
        Dummy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Extension modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Extension modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_adhoc/" class="md-nav__link">
        mod_adhoc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_amp/" class="md-nav__link">
        mod_amp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_auth_token/" class="md-nav__link">
        mod_auth_token
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_blocking/" class="md-nav__link">
        mod_blocking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_bosh/" class="md-nav__link">
        mod_bosh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_caps/" class="md-nav__link">
        mod_caps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_cache_users/" class="md-nav__link">
        mod_cache_users
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_carboncopy/" class="md-nav__link">
        mod_carboncopy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_csi/" class="md-nav__link">
        mod_csi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_disco/" class="md-nav__link">
        mod_disco
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_domain_isolation/" class="md-nav__link">
        mod_domain_isolation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_12" >
      
      
      
        <label class="md-nav__link" for="__nav_8_12" id="__nav_8_12_label" tabindex="0">
          mod_event_pusher
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_12_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8_12">
          <span class="md-nav__icon md-icon"></span>
          mod_event_pusher
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_event_pusher/" class="md-nav__link">
        mod_event_pusher
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_event_pusher_http/" class="md-nav__link">
        HTTP backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_event_pusher_push/" class="md-nav__link">
        Push backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_event_pusher_rabbit/" class="md-nav__link">
        RabbitMQ backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_event_pusher_sns/" class="md-nav__link">
        SNS backend
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_extdisco/" class="md-nav__link">
        mod_extdisco
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_global_distrib/" class="md-nav__link">
        mod_global_distrib
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_http_upload/" class="md-nav__link">
        mod_http_upload
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_inbox/" class="md-nav__link">
        mod_inbox
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_jingle_sip/" class="md-nav__link">
        mod_jingle_sip
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_keystore/" class="md-nav__link">
        mod_keystore
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_last/" class="md-nav__link">
        mod_last
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          mod_mam
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        mod_mam
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#module-description" class="md-nav__link">
    Module Description
  </a>
  
    <nav class="md-nav" aria-label="Module Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-retraction" class="md-nav__link">
    Message retraction
  </a>
  
    <nav class="md-nav" aria-label="Message retraction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retraction-on-the-stanza-id" class="md-nav__link">
    Retraction on the stanza-id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-text-search" class="md-nav__link">
    Full Text Search
  </a>
  
    <nav class="md-nav" aria-label="Full Text Search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note-on-full-text-search-with-elasticsearch-backend" class="md-nav__link">
    Note on full text search with ElasticSearch backend
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
    <nav class="md-nav" aria-label="Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mambackend" class="md-nav__link">
    modules.mod_mam.backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamno_stanzaid_element" class="md-nav__link">
    modules.mod_mam.no_stanzaid_element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamis_archivable_message" class="md-nav__link">
    modules.mod_mam.is_archivable_message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamsend_message" class="md-nav__link">
    modules.mod_mam.send_message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamarchive_chat_markers" class="md-nav__link">
    modules.mod_mam.archive_chat_markers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mammessage_retraction" class="md-nav__link">
    modules.mod_mam.message_retraction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-one-to-one-message-archive" class="md-nav__link">
    Enable one-to-one message archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-one-to-one-message-archive" class="md-nav__link">
    Disable one-to-one message archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pm-specific-options" class="md-nav__link">
    PM-specific options
  </a>
  
    <nav class="md-nav" aria-label="PM-specific options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mampmarchive_groupchats" class="md-nav__link">
    modules.mod_mam.pm.archive_groupchats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mampmsame_mam_id_for_peers" class="md-nav__link">
    modules.mod_mam.pm.same_mam_id_for_peers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-muc-message-archive" class="md-nav__link">
    Enable MUC message archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-muc-message-archive" class="md-nav__link">
    Disable MUC message archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#muc-specific-options" class="md-nav__link">
    MUC-specific options
  </a>
  
    <nav class="md-nav" aria-label="MUC-specific options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mammuchost" class="md-nav__link">
    modules.mod_mam.muc.host
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdbms-backend-options" class="md-nav__link">
    RDBMS backend options
  </a>
  
    <nav class="md-nav" aria-label="RDBMS backend options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamcache_users" class="md-nav__link">
    modules.mod_mam.cache_users
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamcachemodule" class="md-nav__link">
    modules.mod_mam.cache.module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamasync_writerenabled" class="md-nav__link">
    modules.mod_mam.async_writer.enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamasync_writerflush_interval" class="md-nav__link">
    modules.mod_mam.async_writer.flush_interval
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamasync_writerbatch_size" class="md-nav__link">
    modules.mod_mam.async_writer.batch_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamasync_writerpool_size" class="md-nav__link">
    modules.mod_mam.async_writer.pool_size
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-backend-options" class="md-nav__link">
    Common backend options
  </a>
  
    <nav class="md-nav" aria-label="Common backend options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamuser_prefs_store" class="md-nav__link">
    modules.mod_mam.user_prefs_store
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamfull_text_search" class="md-nav__link">
    modules.mod_mam.full_text_search
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_archivable_message3-callback" class="md-nav__link">
    is_archivable_message/3 callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archiving-chat-markers" class="md-nav__link">
    Archiving chat markers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#riak-backend" class="md-nav__link">
    Riak backend
  </a>
  
    <nav class="md-nav" aria-label="Riak backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#riak-specific-options" class="md-nav__link">
    Riak-specific options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamriakbucket_type" class="md-nav__link">
    modules.mod_mam.riak.bucket_type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamriaksearch_index" class="md-nav__link">
    modules.mod_mam.riak.search_index
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cassandra-backend" class="md-nav__link">
    Cassandra backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch-backend" class="md-nav__link">
    ElasticSearch backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#low-level-options" class="md-nav__link">
    Low-level options
  </a>
  
    <nav class="md-nav" aria-label="Low-level options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamdefault_result_limit" class="md-nav__link">
    modules.mod_mam.default_result_limit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mammax_result_limit" class="md-nav__link">
    modules.mod_mam.max_result_limit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamenforce_simple_queries" class="md-nav__link">
    modules.mod_mam.enforce_simple_queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamdelete_domain_limit" class="md-nav__link">
    modules.mod_mam.delete_domain_limit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamdb_jid_format" class="md-nav__link">
    modules.mod_mam.db_jid_format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamdb_message_format" class="md-nav__link">
    modules.mod_mam.db_message_format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamextra_fin_element" class="md-nav__link">
    modules.mod_mam.extra_fin_element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamextra_lookup_params" class="md-nav__link">
    modules.mod_mam.extra_lookup_params
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-configuration" class="md-nav__link">
    Example configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    Metrics
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_muc/" class="md-nav__link">
        mod_muc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_muc_log/" class="md-nav__link">
        mod_muc_log
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_muc_light/" class="md-nav__link">
        mod_muc_light
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_offline/" class="md-nav__link">
        mod_offline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_offline_stub/" class="md-nav__link">
        mod_offline_stub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_ping/" class="md-nav__link">
        mod_ping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_presence/" class="md-nav__link">
        mod_presence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_privacy/" class="md-nav__link">
        mod_privacy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_private/" class="md-nav__link">
        mod_private
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_pubsub/" class="md-nav__link">
        mod_pubsub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_push_service_mongoosepush/" class="md-nav__link">
        mod_push_service_mongoosepush
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_register/" class="md-nav__link">
        mod_register
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_roster/" class="md-nav__link">
        mod_roster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_shared_roster_ldap/" class="md-nav__link">
        mod_shared_roster_ldap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_smart_markers/" class="md-nav__link">
        mod_smart_markers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_sic/" class="md-nav__link">
        mod_sic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_stream_management/" class="md-nav__link">
        mod_stream_management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_time/" class="md-nav__link">
        mod_time
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_vcard/" class="md-nav__link">
        mod_vcard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mod_version/" class="md-nav__link">
        mod_version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          REST API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          REST API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rest-api/Client-frontend/" class="md-nav__link">
        Client/frontend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rest-api/Administration-backend/" class="md-nav__link">
        Administration backend
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          GraphQL API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          GraphQL API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../graphql-api/User-GraphQL/" class="md-nav__link">
        User
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../graphql-api/Admin-GraphQL/" class="md-nav__link">
        Admin
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
      
      
      
        <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
          Operation and Maintenance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Operation and Maintenance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/gdpr-considerations/" class="md-nav__link">
        GDPR considerations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Cluster-management-considerations/" class="md-nav__link">
        Cluster management considerations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Cluster-configuration-and-node-management/" class="md-nav__link">
        Cluster configuration and node management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Logging-%26-monitoring/" class="md-nav__link">
        Logging & monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Logging/" class="md-nav__link">
        Logging configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Humio/" class="md-nav__link">
        Logging with Humio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Logging-fields/" class="md-nav__link">
        Logging fields
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Rolling-upgrade/" class="md-nav__link">
        Rolling upgrade
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Cluster-restart/" class="md-nav__link">
        Cluster restart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/MongooseIM-metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/System-Metrics-Privacy-Policy/" class="md-nav__link">
        System Metrics Privacy Policy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/tls-distribution/" class="md-nav__link">
        Distribution over TLS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/known-issues/" class="md-nav__link">
        Known issues
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
      
      
      
        <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
          Developer's Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Developer's Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/release_config/" class="md-nav__link">
        Release/Installation configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Bootstrap-Scripts/" class="md-nav__link">
        Bootstrap scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Testing-MongooseIM/" class="md-nav__link">
        Testing MongooseIM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Hooks-and-handlers/" class="md-nav__link">
        Hooks and Handlers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/hooks_description/" class="md-nav__link">
        Hooks description
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/accumulators/" class="md-nav__link">
        Accumulators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Stanza-routing/" class="md-nav__link">
        Stanza routing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/domain_management/" class="md-nav__link">
        Domain management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/mod_amp_developers_guide/" class="md-nav__link">
        mod_amp development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/mod_muc_light_developers_guide/" class="md-nav__link">
        mod_muc_light developers doc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/SCRAM-serialization/" class="md-nav__link">
        SCRAM serialization format
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/xep_tool/" class="md-nav__link">
        xep-tool usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/OpenSSL-and-FIPS/" class="md-nav__link">
        FIPS mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Basic-iq-handler/" class="md-nav__link">
        Basic IQ Handler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/mongoose_wpool/" class="md-nav__link">
        mongoose_wpool
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
      
      
      
        <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
          Migration Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Migration Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.1.1_3.2.0/" class="md-nav__link">
        3.1.1 to 3.2.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.3.0_3.4.0/" class="md-nav__link">
        3.3.0 to 3.4.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.5.0_3.6.0/" class="md-nav__link">
        3.5.0 to 3.6.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.6.0_3.7.0/" class="md-nav__link">
        3.6.0 to 3.7.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.7.0_4.0.0/" class="md-nav__link">
        3.7.0 to 4.0.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/4.0.0_4.0.1/" class="md-nav__link">
        4.0.0 to 4.0.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/4.0.1_4.1.0/" class="md-nav__link">
        4.0.1 to 4.1.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/4.1.0_4.2.0/" class="md-nav__link">
        4.1.0 to 4.2.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/4.2.0_5.0.0/" class="md-nav__link">
        4.2.0 to 5.0.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/5.0.0_5.1.0/" class="md-nav__link">
        5.0.0 to 5.1.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/5.1.0_6.0.0/" class="md-nav__link">
        5.1.0 to 6.0.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/6.0.0_6.1.0/" class="md-nav__link">
        6.0.0 to 6.1.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/jid-from-mam-muc-script/" class="md-nav__link">
        MAM MUC migration helper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Contributions/" class="md-nav__link">
        Contributions to the Ecosystem
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../History/" class="md-nav__link">
        MongooseIM History
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#module-description" class="md-nav__link">
    Module Description
  </a>
  
    <nav class="md-nav" aria-label="Module Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-retraction" class="md-nav__link">
    Message retraction
  </a>
  
    <nav class="md-nav" aria-label="Message retraction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retraction-on-the-stanza-id" class="md-nav__link">
    Retraction on the stanza-id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-text-search" class="md-nav__link">
    Full Text Search
  </a>
  
    <nav class="md-nav" aria-label="Full Text Search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note-on-full-text-search-with-elasticsearch-backend" class="md-nav__link">
    Note on full text search with ElasticSearch backend
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
    <nav class="md-nav" aria-label="Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mambackend" class="md-nav__link">
    modules.mod_mam.backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamno_stanzaid_element" class="md-nav__link">
    modules.mod_mam.no_stanzaid_element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamis_archivable_message" class="md-nav__link">
    modules.mod_mam.is_archivable_message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamsend_message" class="md-nav__link">
    modules.mod_mam.send_message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamarchive_chat_markers" class="md-nav__link">
    modules.mod_mam.archive_chat_markers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mammessage_retraction" class="md-nav__link">
    modules.mod_mam.message_retraction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-one-to-one-message-archive" class="md-nav__link">
    Enable one-to-one message archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-one-to-one-message-archive" class="md-nav__link">
    Disable one-to-one message archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pm-specific-options" class="md-nav__link">
    PM-specific options
  </a>
  
    <nav class="md-nav" aria-label="PM-specific options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mampmarchive_groupchats" class="md-nav__link">
    modules.mod_mam.pm.archive_groupchats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mampmsame_mam_id_for_peers" class="md-nav__link">
    modules.mod_mam.pm.same_mam_id_for_peers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-muc-message-archive" class="md-nav__link">
    Enable MUC message archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-muc-message-archive" class="md-nav__link">
    Disable MUC message archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#muc-specific-options" class="md-nav__link">
    MUC-specific options
  </a>
  
    <nav class="md-nav" aria-label="MUC-specific options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mammuchost" class="md-nav__link">
    modules.mod_mam.muc.host
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdbms-backend-options" class="md-nav__link">
    RDBMS backend options
  </a>
  
    <nav class="md-nav" aria-label="RDBMS backend options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamcache_users" class="md-nav__link">
    modules.mod_mam.cache_users
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamcachemodule" class="md-nav__link">
    modules.mod_mam.cache.module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamasync_writerenabled" class="md-nav__link">
    modules.mod_mam.async_writer.enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamasync_writerflush_interval" class="md-nav__link">
    modules.mod_mam.async_writer.flush_interval
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamasync_writerbatch_size" class="md-nav__link">
    modules.mod_mam.async_writer.batch_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamasync_writerpool_size" class="md-nav__link">
    modules.mod_mam.async_writer.pool_size
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-backend-options" class="md-nav__link">
    Common backend options
  </a>
  
    <nav class="md-nav" aria-label="Common backend options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamuser_prefs_store" class="md-nav__link">
    modules.mod_mam.user_prefs_store
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamfull_text_search" class="md-nav__link">
    modules.mod_mam.full_text_search
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_archivable_message3-callback" class="md-nav__link">
    is_archivable_message/3 callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archiving-chat-markers" class="md-nav__link">
    Archiving chat markers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#riak-backend" class="md-nav__link">
    Riak backend
  </a>
  
    <nav class="md-nav" aria-label="Riak backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#riak-specific-options" class="md-nav__link">
    Riak-specific options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamriakbucket_type" class="md-nav__link">
    modules.mod_mam.riak.bucket_type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamriaksearch_index" class="md-nav__link">
    modules.mod_mam.riak.search_index
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cassandra-backend" class="md-nav__link">
    Cassandra backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch-backend" class="md-nav__link">
    ElasticSearch backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#low-level-options" class="md-nav__link">
    Low-level options
  </a>
  
    <nav class="md-nav" aria-label="Low-level options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamdefault_result_limit" class="md-nav__link">
    modules.mod_mam.default_result_limit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mammax_result_limit" class="md-nav__link">
    modules.mod_mam.max_result_limit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamenforce_simple_queries" class="md-nav__link">
    modules.mod_mam.enforce_simple_queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamdelete_domain_limit" class="md-nav__link">
    modules.mod_mam.delete_domain_limit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamdb_jid_format" class="md-nav__link">
    modules.mod_mam.db_jid_format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamdb_message_format" class="md-nav__link">
    modules.mod_mam.db_message_format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamextra_fin_element" class="md-nav__link">
    modules.mod_mam.extra_fin_element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulesmod_mamextra_lookup_params" class="md-nav__link">
    modules.mod_mam.extra_lookup_params
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-configuration" class="md-nav__link">
    Example configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    Metrics
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>mod_mam</h1>

<h2 id="module-description">Module Description</h2>
<p>This module implements <a href="https://xmpp.org/extensions/xep-0313.html">XEP-0313: Message Archive Management</a>.
It enables a service to store all user messages for one-to-one chats as well as group chats (MUC, MultiUser Chat).
It uses <a href="http://xmpp.org/extensions/xep-0059.html">XEP-0059: Result Set Management</a> for paging.
It is a highly customizable module, that requires some skill and knowledge to operate properly and efficiently.</p>
<p>MongooseIM is compatible with MAM 0.4-0.6.</p>
<p>Configure MAM with different storage backends:</p>
<ul>
<li>RDBMS (databases like MySQL, PostgreSQL, MS SQL Server)</li>
<li>Riak KV (deprecated) (NoSQL)</li>
<li>Cassandra (NoSQL)</li>
<li>ElasticSearch (NoSQL)</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Riak is deprecated and its support will be withdrawn in future versions of MongooseIM.</p>
</div>
<p><code>mod_mam</code> is a meta-module that ensures all relevant <code>mod_mam_*</code> modules are loaded and properly configured.</p>
<h3 id="message-retraction">Message retraction</h3>
<p>This module supports <a href="http://xmpp.org/extensions/xep-0424.html">XEP-0424: Message Retraction</a> with RDBMS storage backends. When a <a href="https://xmpp.org/extensions/xep-0424.html#example-4">retraction message</a> is received, the MAM module finds the message to retract and replaces it with a tombstone.</p>
<p>The following criteria are used to find the original message:</p>
<ul>
<li>The <code>id</code> attribute specified in the <code>apply-to</code> element of the retraction message has to be the same as the <code>id</code> attribute of the <code>origin-id</code> (or <code>stanza-id</code> when configured, see <a href="#retraction-on-the-stanza-id">below</a>) element of the original message.</li>
<li>Both messages need to originate from the same user.</li>
<li>Both messages need to be addressed to the same user.</li>
</ul>
<p>If more than one message matches the criteria, only the most recent one is retracted. To avoid this case, it is recommended to use a unique identifier (UUID) as the origin ID.</p>
<h4 id="retraction-on-the-stanza-id">Retraction on the stanza-id</h4>
<p>This module also implements an extension to the XEP, where it allows to specify the <a href="https://xmpp.org/extensions/xep-0359.html#stanza-id"><code>stanza-id</code></a> as <a href="https://xmpp.org/extensions/xep-0313.html#archives_id">created by</a> the server's MAM, instead of the <code>origin-id</code> that the original <a href="https://xmpp.org/extensions/xep-0424.html">XEP-0424</a> specifies. It announces this capability under the namespace <code>urn:esl:message-retract-by-stanza-id:0</code>. This is specially useful in groupchats where the <code>stanza-id</code> of a message is shared and known for all participants.</p>
<p>In this case, to use such functionality,
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;apply-to</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;origin-id-1&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;urn:xmpp:fasten:0&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;retract</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&#39;urn:xmpp:message-retract:0&#39;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/apply-to&gt;</span>
</code></pre></div></td></tr></table></div>
turns into
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;apply-to</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;stanza-id-1&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;urn:xmpp:fasten:0&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;retract</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&#39;urn:esl:message-retract-by-stanza-id:0&#39;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/apply-to&gt;</span>
</code></pre></div></td></tr></table></div>
and likewise, the answer would be tagged by the mentioned <code>esl</code> namespace.</p>
<h3 id="full-text-search">Full Text Search</h3>
<p>This module allows message filtering by their text body (if enabled, see <em>Common backend options</em>).
This means that an XMPP client, while requesting messages from the archive may not only specify standard form fields (<code>with</code>, <code>start</code>, <code>end</code>), but also <code>full-text-search</code> (of type <code>text-single</code>).
If this happens, the client will receive only messages that contain words specified in the request.</p>
<p>The exact behaviour, like whether word ordering matters, may depend on the storage backend in use.
For now <code>rdbms</code> backend has very limited support for this feature, while <code>cassandra</code> does not support it at all.
<code>riak</code> (deprecated) and <code>elasticsearch</code> backends, on the other hand, should provide you with the best results when it comes to text filtering.</p>
<p><code>mod_mam_rdbms_arch</code> returns all messages that contain all search words, order
of words does not matter. Messages are sorted by timestamp (not by relevance).</p>
<h4 id="note-on-full-text-search-with-elasticsearch-backend">Note on full text search with ElasticSearch backend</h4>
<p>When using ElasticSearch MAM backend, the value provided in <code>full-text-search</code> form field will be passed to ElasticSearch as <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html">Simple Search Query</a>.
If you're using our official ElasticSearch mappings from <code>priv/elasticsearch</code> then the query analyzer is set to <code>english</code>.
Also note that the default separator for the search query is <code>AND</code> (which roughly means that ElasticSearch will search for messages containing all the terms provided in the query string).</p>
<h2 id="options">Options</h2>
<h3 id="modulesmod_mambackend"><code>modules.mod_mam.backend</code></h3>
<ul>
<li><strong>Syntax:</strong> string, one of <code>"rdbms"</code>, <code>"riak"</code>, <code>"cassandra"</code> and <code>"elasticsearch"</code></li>
<li><strong>Default:</strong> <code>"rdbms"</code></li>
<li><strong>Example:</strong> <code>backend = "riak"</code></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Riak is deprecated and its support will be withdrawn in future versions of MongooseIM.</p>
</div>
<p>Database backend to use.</p>
<h3 id="modulesmod_mamno_stanzaid_element"><code>modules.mod_mam.no_stanzaid_element</code></h3>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>false</code></li>
<li><strong>Example:</strong> <code>no_stanzaid_element = true</code></li>
</ul>
<p>Do not add a <code>&lt;stanza-id/&gt;</code> element from MAM v0.6.</p>
<h3 id="modulesmod_mamis_archivable_message"><code>modules.mod_mam.is_archivable_message</code></h3>
<ul>
<li><strong>Syntax:</strong> non-empty string</li>
<li><strong>Default:</strong> <code>"mod_mam_utils"</code></li>
<li><strong>Example:</strong> <code>is_archivable_message = "mod_mam_utils"</code></li>
</ul>
<p>Name of a module implementing <a href="#is_archivable_message"><code>is_archivable_message/3</code> callback</a> that determines if the message should be archived.</p>
<h3 id="modulesmod_mamsend_message"><code>modules.mod_mam.send_message</code></h3>
<ul>
<li><strong>Syntax:</strong> non-empty string</li>
<li><strong>Default:</strong> <code>"mod_mam_utils"</code></li>
<li><strong>Example:</strong> <code>send_message = "mod_mam_utils"</code></li>
</ul>
<p>Name of a module implementing <code>send_message/4</code> callback that routes a message during lookup operation.
Consult with <code>mod_mam_utils:send_message/4</code> code for more information.</p>
<p>Check <code>big_tests/tests/mam_send_message_SUITE_data/mam_send_message_example.erl</code> file
in the MongooseIM repository for the usage example.</p>
<h3 id="modulesmod_mamarchive_chat_markers"><code>modules.mod_mam.archive_chat_markers</code></h3>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>false</code></li>
<li><strong>Example:</strong> <code>archive_chat_markers = true</code></li>
</ul>
<p>If set to true, XEP-0333 chat markers will be archived.
See more details <a href="#archiving-chat-markers">here</a>.</p>
<h3 id="modulesmod_mammessage_retraction"><code>modules.mod_mam.message_retraction</code></h3>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>true</code></li>
<li><strong>Example:</strong> <code>message_retraction = false</code></li>
</ul>
<p>Enables <a href="http://xmpp.org/extensions/xep-0424.html">XEP-0424: Message Retraction</a>.
This functionality is currently implemented only for the <code>rdbms</code> backend.
<a href="https://xmpp.org/extensions/xep-0424.html#example-4">Retraction messages</a> are always archived regardless of this option.</p>
<p><strong>backend</strong>, <strong>no_stanzaid_element</strong>, <strong>is_archivable_message</strong> and <strong>message_retraction</strong> will be applied to both <code>pm</code> and <code>muc</code> (if they are enabled), unless overridden explicitly (see example below).</p>
<h3 id="enable-one-to-one-message-archive">Enable one-to-one message archive</h3>
<p>Archive for one-to-one messages can be enabled in one of two ways:</p>
<ul>
<li>Specify <code>[mod_mam.pm]</code> section</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[modules.mod_mam]</span>
<span class="p">[</span><span class="n">modules</span><span class="p">.</span><span class="n">mod_mam</span><span class="p">.</span><span class="n">pm</span><span class="p">]</span><span class="w"> </span><span class="c1"># defining this section enables PM support</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Define any PM related option</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[modules.mod_mam]</span>
<span class="w">  </span><span class="n">pm</span><span class="p">.</span><span class="n">backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rdbms&quot;</span><span class="w"> </span><span class="c1"># enables PM support and overrides its backend</span>
</code></pre></div></td></tr></table></div>
<h3 id="disable-one-to-one-message-archive">Disable one-to-one message archive</h3>
<p>To disable archive for one-to-one messages please remove PM section or any PM related option from the config file.</p>
<h3 id="pm-specific-options">PM-specific options</h3>
<h4 id="modulesmod_mampmarchive_groupchats"><code>modules.mod_mam.pm.archive_groupchats</code></h4>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>false</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.pm.archive_groupchats = true</code></li>
</ul>
<p>When enabled, MAM will store groupchat messages in recipients' individual archives. <strong>USE WITH CAUTION!</strong> May increase archive size significantly. Disabling this option for existing installation will neither remove such messages from MAM storage, nor will filter out them from search results.</p>
<h4 id="modulesmod_mampmsame_mam_id_for_peers"><code>modules.mod_mam.pm.same_mam_id_for_peers</code></h4>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>false</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.pm.same_mam_id_for_peers = true</code></li>
</ul>
<p>When enabled, MAM will set the same MAM ID for both sender and recipient. This can be useful in combination with <a href="#retraction-on-the-stanza-id">retraction on the stanza-id</a>. Note that this might not work with clients across federation, as the recipient might not implement the same retraction, nor the same IDs.</p>
<h3 id="enable-muc-message-archive">Enable MUC message archive</h3>
<p>Archive for MUC messages can be enabled in one of two ways:</p>
<ul>
<li>Specify <code>[mod_mam.muc]</code> section</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[modules.mod_mam]</span>
<span class="p">[</span><span class="n">modules</span><span class="p">.</span><span class="n">mod_mam</span><span class="p">.</span><span class="n">muc</span><span class="p">]</span><span class="w"> </span><span class="c1"># defining this section enables MUC support</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Define any MUC related option</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[modules.mod_mam]</span>
<span class="w">  </span><span class="n">muc</span><span class="p">.</span><span class="n">backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rdbms&quot;</span><span class="w"> </span><span class="c1"># enables MUC support and overrides its backend</span>
</code></pre></div></td></tr></table></div>
<h3 id="disable-muc-message-archive">Disable MUC message archive</h3>
<p>To disable archive for MUC messages please remove MUC section or any MUC related option from the config file.</p>
<h3 id="muc-specific-options">MUC-specific options</h3>
<h4 id="modulesmod_mammuchost"><code>modules.mod_mam.muc.host</code></h4>
<ul>
<li><strong>Syntax:</strong> string</li>
<li><strong>Default:</strong> <code>"conference.@HOST@"</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.muc.host = "conference.@HOST@"</code></li>
</ul>
<p>The MUC host that will be archived if MUC archiving is enabled.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you are using MUC Light, make sure this option is set to the MUC Light domain</p>
</div>
<h4 id="example">Example</h4>
<p>The example below presents how to override common option for <code>muc</code> module specifically.
Please note that you can override all common options (except <code>cache</code>) in a similar way.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[modules.mod_mam]</span>
<span class="w">  </span><span class="n">backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rdbms&quot;</span>
<span class="w">  </span><span class="n">async_writer</span><span class="p">.</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">true</span><span class="w"> </span><span class="c1"># this option enables async writer for RDBMS backend</span>
<span class="w">  </span><span class="n">muc</span><span class="p">.</span><span class="n">async_writer</span><span class="p">.</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">false</span><span class="w"> </span><span class="c1"># disable async writer for MUC archive only</span>
</code></pre></div></td></tr></table></div>
<h3 id="rdbms-backend-options">RDBMS backend options</h3>
<p>These options will only have effect when the <code>rdbms</code> backend is used:</p>
<h4 id="modulesmod_mamcache_users"><code>modules.mod_mam.cache_users</code></h4>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>true</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.cache_users = false</code></li>
</ul>
<p>Enables Archive ID to integer mappings cache.</p>
<p>If caching is enabled, by default it will spawn its own <a href="https://github.com/esl/segmented_cache">segmented cache</a> cache, with defaults as in <a href="../mod_cache_users/"><code>mod_cache_users</code></a>. To change these defaults, the same config can be accessed within the <code>cache</code> key. To see details about the meaning of each flag, see <a href="../mod_cache_users/"><code>mod_cache_users</code></a>. To reuse the cache already created by <code>mod_cache_users</code>, see the option below.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">modules</span><span class="p">.</span><span class="n">mod_mam</span><span class="p">.</span><span class="n">cache</span><span class="p">.</span><span class="n">strategy</span>
<span class="n">modules</span><span class="p">.</span><span class="n">mod_mam</span><span class="p">.</span><span class="n">cache</span><span class="p">.</span><span class="n">time_to_live</span>
<span class="n">modules</span><span class="p">.</span><span class="n">mod_mam</span><span class="p">.</span><span class="n">cache</span><span class="p">.</span><span class="n">number_of_segments</span>
</code></pre></div></td></tr></table></div>
<h4 id="modulesmod_mamcachemodule"><code>modules.mod_mam.cache.module</code></h4>
<ul>
<li><strong>Syntax:</strong> string, one of <code>"mod_cache_users"</code> or <code>"internal"</code></li>
<li><strong>Default:</strong> <code>internal</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.cache.module = "mod_cache_users"</code></li>
</ul>
<p>Configures which cache to use, either start an internal instance, or reuse the cache created by <code>mod_cache_users</code>, if such module was enabled. Note that if reuse is desired – that is, <code>cache.module = "mod_cache_users"</code>, other cache configuration parameters will be ignored.</p>
<h4 id="modulesmod_mamasync_writerenabled"><code>modules.mod_mam.async_writer.enabled</code></h4>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>true</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.async_writer.enabled = false</code></li>
</ul>
<p>Enables an asynchronous writer that is faster than the synchronous one but harder to debug.
The async writers store batches of messages that will be flush on a timeout (see <strong>flush_interval</strong>) or when the batch reaches a size (see <strong>batch_size</strong>), so the results of the lookup operations executed right after message routing may be incomplete until the configured time passes or the queue is full.</p>
<h4 id="modulesmod_mamasync_writerflush_interval"><code>modules.mod_mam.async_writer.flush_interval</code></h4>
<ul>
<li><strong>Syntax:</strong> non-negative integer</li>
<li><strong>Default:</strong> <code>2000</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.async_writer.flush_interval = 2000</code></li>
</ul>
<p>How often (in milliseconds) the buffered messages are flushed to DB.</p>
<h4 id="modulesmod_mamasync_writerbatch_size"><code>modules.mod_mam.async_writer.batch_size</code></h4>
<ul>
<li><strong>Syntax:</strong> non-negative integer</li>
<li><strong>Default:</strong> <code>30</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.async_writer.batch_size = 30</code></li>
</ul>
<p>Max size of the batch for an async writer before the queue is considered full and flushed.
If the buffer is full, messages are flushed to a database immediately and the flush timer is reset.</p>
<h4 id="modulesmod_mamasync_writerpool_size"><code>modules.mod_mam.async_writer.pool_size</code></h4>
<ul>
<li><strong>Syntax:</strong> non-negative integer</li>
<li><strong>Default:</strong> <code>4 * erlang:system_info(schedulers_online)</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.async_writer.pool_size = 32</code></li>
</ul>
<p>Number of workers in the pool. More than the number of available schedulers is recommended, to minimise lock contention on the message queues, and more than the number of DB workers, to fully utilise the DB capacity. How much more than these two parameters is then a good fine-tuning for specific deployments.</p>
<h3 id="common-backend-options">Common backend options</h3>
<h4 id="modulesmod_mamuser_prefs_store"><code>modules.mod_mam.user_prefs_store</code></h4>
<ul>
<li><strong>Syntax:</strong> one of <code>"rdbms"</code>, <code>"cassandra"</code>, <code>"mnesia"</code></li>
<li><strong>Default:</strong> not set</li>
<li><strong>Example:</strong> <code>modules.mod_mam.user_prefs_store = "rdbms"</code></li>
</ul>
<p>Leaving this option unset will prevent users from setting their archiving preferences.
It will also increase performance.
The possible values are:</p>
<ul>
<li><code>"rdbms"</code> (RDBMS backend only) - User archiving preferences saved in RDBMS. Slow and not recommended, but might be used for simplicity (keeping everything in RDBMS).</li>
<li><code>"cassandra"</code> (Cassandra backend only) - User archiving preferences are saved in Cassandra.</li>
<li><code>"mnesia"</code> (recommended) - User archiving preferences saved in Mnesia and accessed without transactions. Recommended in most deployments, could be overloaded with lots of users updating their preferences at once. There's a small risk of an inconsistent (in a rather harmless way) state of the preferences table.</li>
</ul>
<h4 id="modulesmod_mamfull_text_search"><code>modules.mod_mam.full_text_search</code></h4>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>true</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.full_text_search = false</code></li>
</ul>
<p>Enables full text search in message archive (see <em>Full Text Search</em> paragraph).
Please note that the full text search is currently only implemented for <code>"rdbms"</code> and <code>"riak(deprecated)"</code> backends.
Also, full text search works only for messages archived while this option is enabled.</p>
<h4 id="is_archivable_message3-callback"><a id="is_archivable_message"></a><code>is_archivable_message/3</code> callback</h4>
<p><code>is_archivable_message</code> option has to name a module exporting <code>is_archivable_message/3</code> function conforming to the spec:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">-</span><span class="ni">spec</span><span class="w"> </span><span class="n">is_archivable_message</span><span class="p">(</span><span class="nv">Mod</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">module</span><span class="p">(),</span><span class="w"> </span><span class="nv">Dir</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">incoming</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">outgoing</span><span class="p">,</span>
<span class="w">                          </span><span class="nv">Packet</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nn">exml</span><span class="p">:</span><span class="nb">element</span><span class="p">())</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">boolean</span><span class="p">().</span>
</code></pre></div></td></tr></table></div>
<p>Servers SHOULD NOT archive messages that do not have a <code>&lt;body/&gt;</code> child tag. Servers SHOULD NOT archive delayed messages.</p>
<p>By default, all messages that hold meaningful content, rather than state changes such as Chat State Notifications, are archived.</p>
<h4 id="archiving-chat-markers">Archiving chat markers</h4>
<p>Archiving chat markers can be enabled by setting <code>archive_chat_markers</code> option to <code>true</code>. However it only works if
<code>is_archivable_message</code> callback module is set to <code>mod_mam_utils</code> or isn't set at all.</p>
<p>When performing full text search chat markers are treated as if they had empty message body.</p>
<h3 id="riak-backend">Riak backend</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Riak is deprecated and its support will be withdrawn in future versions of MongooseIM.</p>
</div>
<p>The Riak KV backend for MAM stores messages in weekly buckets so it's easier to remove old buckets.
Archive querying is done using Riak KV 2.0 <a href="http://docs.basho.com/riak/2.1.1/dev/using/search/">search mechanism</a> called Yokozuna.
Your instance of Riak KV must be configured with Yokozuna enabled.</p>
<p>This backend works with Riak KV 2.0 and above, but we recommend version 2.1.1.</p>
<h4 id="riak-specific-options">Riak-specific options</h4>
<h4 id="modulesmod_mamriakbucket_type"><code>modules.mod_mam.riak.bucket_type</code></h4>
<ul>
<li><strong>Syntax:</strong> non-empty string</li>
<li><strong>Default:</strong> <code>"mam_yz"</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.riak.bucket_type = "mam_yz"</code></li>
</ul>
<p>Riak bucket type.</p>
<h4 id="modulesmod_mamriaksearch_index"><code>modules.mod_mam.riak.search_index</code></h4>
<ul>
<li><strong>Syntax:</strong> non-empty string</li>
<li><strong>Default:</strong> <code>"mam"</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.riak.search_index = "mam"</code></li>
</ul>
<p>Riak index name.</p>
<h3 id="cassandra-backend">Cassandra backend</h3>
<p>Please consult <a href="../../configuration/outgoing-connections/#cassandra-options">Outgoing connections</a> page to learn how to properly configure Cassandra connection pool.
By default, <code>mod_mam</code> Cassandra backend requires <code>global</code> pool with <code>default</code> tag.</p>
<h3 id="elasticsearch-backend">ElasticSearch backend</h3>
<p>First, make sure that your ElasticSearch cluster has expected indexes and mappings in place.
Please consult <a href="../../configuration/outgoing-connections/#elasticsearch-options">Outgoing connections</a> page to learn how to properly configure ElasticSearch connection pool.</p>
<h3 id="low-level-options">Low-level options</h3>
<p>These options allow for fine-grained control over MAM behaviour.</p>
<h4 id="modulesmod_mamdefault_result_limit"><code>modules.mod_mam.default_result_limit</code></h4>
<ul>
<li><strong>Syntax:</strong> non-negative integer</li>
<li><strong>Default:</strong> <code>50</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.default_result_limit = 100</code></li>
</ul>
<p>This sets the default page size of returned results.</p>
<h4 id="modulesmod_mammax_result_limit"><code>modules.mod_mam.max_result_limit</code></h4>
<ul>
<li><strong>Syntax:</strong> non-negative integer</li>
<li><strong>Default:</strong> <code>50</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.max_result_limit = 100</code></li>
</ul>
<p>This sets the maximum page size of returned results.</p>
<h4 id="modulesmod_mamenforce_simple_queries"><code>modules.mod_mam.enforce_simple_queries</code></h4>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>false</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.enforce_simple_queries = true</code></li>
</ul>
<p>This enforces all mam lookups to be "simple", i.e., they skip the RSM count.
See <a href="../../open-extensions/mam/">Message Archive Management extensions</a>.</p>
<h4 id="modulesmod_mamdelete_domain_limit"><code>modules.mod_mam.delete_domain_limit</code></h4>
<ul>
<li><strong>Syntax:</strong> non-negative integer or the string <code>"infinity"</code></li>
<li><strong>Default:</strong> <code>"infinity"</code></li>
<li><strong>Example:</strong> <code>modules.mod_mam.delete_domain_limit = 10000</code></li>
</ul>
<p>Domain deletion can be an expensive operation, as it requires to delete potentially many thousands of records from the DB. By default, the delete operation deletes everything in a transaction, but it might be desired, to handle timeouts and table locks more gracefully, to delete the records in batches. This limit establishes the size of the batch.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Not supported by MSSQL.</p>
</div>
<h4 id="modulesmod_mamdb_jid_format"><code>modules.mod_mam.db_jid_format</code></h4>
<ul>
<li><strong>Syntax:</strong> string, one of <code>"mam_jid_rfc"</code>, <code>"mam_jid_rfc_trust"</code>, <code>"mam_jid_mini"</code> or a module implementing <code>mam_jid</code> behaviour</li>
<li><strong>Default:</strong> <code>"mam_jid_rfc"</code> for MUC archive, <code>"mam_jid_mini"</code> for PM archive</li>
<li><strong>Example:</strong> <code>modules.mod_mam.db_jid_format = "mam_jid_mini"</code></li>
</ul>
<p>Sets the internal MAM jid encoder/decoder module for RDBMS.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Archive MUST be empty to change this option</p>
</div>
<h4 id="modulesmod_mamdb_message_format"><code>modules.mod_mam.db_message_format</code></h4>
<ul>
<li><strong>Syntax:</strong> string, one of <code>"mam_message_xml"</code>, <code>"mam_message_eterm"</code>, <code>"mam_message_compressed_eterm"</code> or a module implementing <code>mam_message</code> behaviour</li>
<li><strong>Default:</strong> <code>"mam_message_compressed_eterm"</code> for RDBMS, <code>"mam_message_xml"</code> for Riak and Cassandra</li>
<li><strong>Example:</strong> <code>modules.mod_mam.db_message_format = "mam_message_compressed_eterm"</code></li>
</ul>
<p>Sets the internal MAM message encoder/decoder module.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Archive MUST be empty to change this option</p>
</div>
<h4 id="modulesmod_mamextra_fin_element"><code>modules.mod_mam.extra_fin_element</code></h4>
<ul>
<li><strong>Syntax:</strong> string, a module implementing the <code>extra_fin_element/3</code> callback</li>
<li><strong>Default:</strong> none</li>
<li><strong>Example:</strong> <code>modules.mod_mam.extra_fin_element = "example_mod"</code></li>
</ul>
<p>This module can be used to add subelements to the <code>&lt;fin&gt;</code> element of the MAM lookup query response.
It can be useful to be able to add information to a mam query, that doesn't belong to any specific message but to all of them.</p>
<h4 id="modulesmod_mamextra_lookup_params"><code>modules.mod_mam.extra_lookup_params</code></h4>
<ul>
<li><strong>Syntax:</strong> string, a module implementing the <code>extra_lookup_params/2</code> callback</li>
<li><strong>Default:</strong> none</li>
<li><strong>Example:</strong> <code>modules.mod_mam.extra_lookup_params = "example_mod"</code></li>
</ul>
<p>This module can be used to add extra lookup parameters to MAM lookup queries.</p>
<h2 id="example-configuration">Example configuration</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">[modules.mod_mam]</span>
<span class="w">  </span><span class="n">backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rdbms&quot;</span>
<span class="w">  </span><span class="n">no_stanzaid_element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="w">  </span><span class="n">pm</span><span class="p">.</span><span class="n">user_prefs_store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rdbms&quot;</span>

<span class="w">  </span><span class="n">muc</span><span class="p">.</span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;muc.example.com&quot;</span>
<span class="w">  </span><span class="n">muc</span><span class="p">.</span><span class="n">db_message_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mam_message_xml&quot;</span>
<span class="w">  </span><span class="n">muc</span><span class="p">.</span><span class="n">async_writer</span><span class="p">.</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">  </span><span class="n">muc</span><span class="p">.</span><span class="n">user_prefs_store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mnesia&quot;</span>
</code></pre></div></td></tr></table></div>
<h2 id="metrics">Metrics</h2>
<p>If you'd like to learn more about metrics in MongooseIM, please visit <a href="../../operation-and-maintenance/MongooseIM-metrics/">MongooseIM metrics</a> page.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description (when it gets incremented)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[HostType, modMamArchiveRemoved]</code></td>
<td>spiral</td>
<td>User's entire archive is removed.</td>
</tr>
<tr>
<td><code>[HostType, modMamArchived]</code></td>
<td>spiral</td>
<td>A message is stored in user's archive.</td>
</tr>
<tr>
<td><code>[HostType, modMamDropped]</code></td>
<td>spiral</td>
<td>A message couldn't be stored in the DB (and got dropped).</td>
</tr>
<tr>
<td><code>[HostType, modMamDroppedIQ]</code></td>
<td>spiral</td>
<td>MAM IQ has been dropped due to: high query frequency/invalid syntax or type.</td>
</tr>
<tr>
<td><code>[HostType, modMamFlushed]</code></td>
<td>spiral</td>
<td>Message was stored in a DB asynchronously.</td>
</tr>
<tr>
<td><code>[HostType, modMamForwarded]</code></td>
<td>spiral</td>
<td>A message is sent to a client as a part of a MAM query result.</td>
</tr>
<tr>
<td><code>[HostType, modMamLookups]</code></td>
<td>spiral</td>
<td>A MAM lookup is performed.</td>
</tr>
<tr>
<td><code>[HostType, modMamPrefsGets]</code></td>
<td>spiral</td>
<td>Archiving preferences have been requested by a client.</td>
</tr>
<tr>
<td><code>[HostType, modMamPrefsSets]</code></td>
<td>spiral</td>
<td>Archiving preferences have been updated by a client.</td>
</tr>
<tr>
<td><code>[HostType, modMucMamArchiveRemoved]</code></td>
<td>spiral</td>
<td>Room's entire archive is removed.</td>
</tr>
<tr>
<td><code>[HostType, modMucMamArchived]</code></td>
<td>spiral</td>
<td>A message is stored in room's archive.</td>
</tr>
<tr>
<td><code>[HostType, modMucMamForwarded]</code></td>
<td>spiral</td>
<td>A message is sent to a client as a part of a MAM query result from MUC room.</td>
</tr>
<tr>
<td><code>[HostType, modMucMamLookups]</code></td>
<td>spiral</td>
<td>A MAM lookup in MUC room is performed.</td>
</tr>
<tr>
<td><code>[HostType, modMucMamPrefsGets]</code></td>
<td>spiral</td>
<td>MUC archiving preferences have been requested by a client.</td>
</tr>
<tr>
<td><code>[HostType, modMucMamPrefsSets]</code></td>
<td>spiral</td>
<td>MUC archiving preferences have been updated by a client.</td>
</tr>
<tr>
<td><code>[HostType, mod_mam_rdbms_async_pool_writer, per_message_flush_time]</code></td>
<td>histogram</td>
<td>Average time per message insert measured in an async MAM worker.</td>
</tr>
<tr>
<td><code>[HostType, mod_mam_rdbms_async_pool_writer, flush_time]</code></td>
<td>histogram</td>
<td>Average time per flush of all buffered messages measured in an async MAM worker.</td>
</tr>
<tr>
<td><code>[HostType, mod_mam_muc_rdbms_async_pool_writer, per_message_flush_time]</code></td>
<td>histogram</td>
<td>Average time per message insert measured in an async MUC MAM worker.</td>
</tr>
<tr>
<td><code>[HostType, mod_mam_muc_rdbms_async_pool_writer, flush_time]</code></td>
<td>histogram</td>
<td>Average time per flush of all buffered messages measured in an async MUC MAM worker.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Backend action</th>
<th>Description (when it gets incremented)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>lookup</code></td>
<td>A lookup in an archive.</td>
</tr>
<tr>
<td><code>archive</code></td>
<td>One message is saved in an archive.</td>
</tr>
</tbody>
</table>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/r/mongooseim/mongooseim/" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/esl/MongooseIM" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.efa0ade1.min.js"></script>
      
    
  </body>
</html>